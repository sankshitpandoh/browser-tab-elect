# Contributing to browser-tab-elect

Thanks for your interest in contributing! This project elects a single browser tab as the leader using BroadcastChannel + localStorage fencing, with a small React hook on top.

## Table of contents
- Getting started
- Project structure
- Development workflow
- Testing
- Code style and quality
- Design/contracts to preserve
- Pull request guidelines
- Release process
- Security / responsible disclosure

## Getting started

```bash
# Fork and clone your fork

git clone https://github.com/sankshitpandoh/browser-tab-elect
cd browser-tab-elect

# Install deps
npm install

# Build once
npm run build

# Run tests
npm test
```

Node 18+ is recommended.

## Project structure

- `src/`
  - `core/elector.ts`: Headless leader election implementation
  - `react/useSingleTabLeader.ts`: React hook wrapper around the core
  - `index.ts`, `react/index.ts`: public entrypoints
- `tests/`: unit/behavior tests using Vitest
- `dist/`: build output (generated by `tsup`)

## Development workflow

- Make changes in `src/` only. Do not edit `dist/`.
- Build locally with `npm run build` to validate types and bundles.
- Add/adjust tests in `tests/` to cover your change.
- Keep changes focused and small when possible.

## Testing

- Run the full suite:

```bash
npm test
```

- Run a single file:

```bash
npm test -- tests/election.behavior.test.ts
```

Notes:
- Tests simulate a minimal browser via stubs; they run under Node.
- Timers are faked; rely on `vi.advanceTimersByTimeAsync` in tests.

## Code style and quality

- Language: TypeScript, `strict: true`.
- Match existing formatting; prefer multi-line clarity over clever one-liners.
- Avoid deep nesting; prefer guard clauses.
- Handle errors meaningfully; do not swallow exceptions unless explicitly safe.
- SSR-safety: All public imports must be safe when `window` is not present.
- Cleanup: Any listeners/intervals/timeouts created must be removed on `stop()`/cleanup paths.

## Design/contracts to preserve

- Deterministic election: highest lexicographic `tabId` wins within the backoff window.
- Fencing: all leader actions require the storage record to match the acting `tabId` and have a live lease.
- Heartbeats: leader renews `leaseUntil` on an interval and broadcasts heartbeats.
- Followers accept the freshest epoch with a live lease.
- Resilience: storage record deletion should trigger a fresh election.
- React: the hook reuses/creates an elector keyed by the full options set; changing options yields a new elector instance.
- Idempotency: `start()` must be safe to call multiple times; `stop()` must fully clean up.

## Pull request guidelines

- Include tests for behavior changes or new features.
- Update README when the public API or observable behavior changes.
- Keep commits tidy; Conventional Commits are appreciated (e.g., `feat:`, `fix:`, `docs:`).
- Ensure `npm run build` and `npm test` pass locally.

## Release process

Releases are currently manual by me:

1) Ensure `main` is green (build + tests).
2) Bump version (semver):

```bash
npm version <patch|minor|major>
```

3) Build and publish:

```bash
npm run build
npm publish
```

4) Push tags:

```bash
git push && git push --tags
```

If you are not a me, you can still help by preparing a PR with changelog notes in the description.

## Security / responsible disclosure

If you believe youâ€™ve found a security issue, please do not open a public issue. Instead, email the maintainer listed in `package.json` or use GitHub security advisories. I will respond and coordinate a fix.

---

Thank you for contributing!

